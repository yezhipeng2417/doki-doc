# 最终项目与答辩讲义（把能力串成可展示成果）

## 本周目标
第12周结束后你应该能做到：
1. 交付一个端到端 Demo：`事件输入 -> Agent 分析/工具调用 -> Guardrails 审查 -> 响应输出 -> 可观测追踪`。
2. 形成一份可复用项目文档：架构、流程、SLO、风险、成本。
3. 能在公司内部做 10-20 分钟技术汇报，表达清晰、可被追问。
4. 对“为什么这样设计”给出工程化理由，而不只是功能演示。
5. 拿出下一阶段优化路线图（可落地）。

---

## 最终项目建议题目（直接可用）
**Ops Copilot（内部运维助手）**

## 业务场景
1. 输入：告警/报错/人工提问。
2. Agent：调用状态查询、错误检索、发布历史工具。
3. Guardrails：拦截敏感输入输出，PII 脱敏。
4. 输出：结论 + 证据 + 下一步建议。
5. 可观测：记录请求链路、工具耗时、拦截事件、成功率。

---

## 讲义知识地图（模块）
1. 模块1：确定范围（Scope）与验收标准。
2. 模块2：搭建端到端主链路（Happy Path）。
3. 模块3：补齐安全链路（Guardrails + 权限边界）。
4. 模块4：补齐可观测与告警。
5. 模块5：演练故障场景与回滚。
6. 模块6：准备答辩材料与演示脚本。
7. 模块7：模拟答辩与收尾交付。

---

## 模块1：范围定义（最重要）

## 1.1 范围控制原则
最终项目不要做大而全，要做“可演示、可解释、可复盘”。

## 1.2 建议最小功能集（MVP）
1. 一个对话入口（CLI 或 Web）。
2. 三个只读工具：
   - 服务健康状态
   - 最近错误摘要
   - 最近部署记录
3. Guardrails 入/出站拦截。
4. 基础日志和指标。
5. 一条故障演练路径。

## 1.3 验收标准（建议）
1. 90% 典型问题能返回结构化答案。
2. 高风险输入拦截成功率可演示。
3. 工具失败时不胡编，能降级处理。
4. 一次端到端演示可在 5 分钟内完成。

## 1.4 模块1 验收
1. 你有明确范围文档。
2. 你有“做/不做”边界清单。

---

## 模块2：主链路打通（Happy Path）

## 2.1 目标链路
`User Query -> Agent -> Tool Calls -> Structured Response`

## 2.2 输出格式统一
建议固定输出：
1. 结论
2. 证据
3. 下一步建议

## 2.3 结构化响应示例
```json
{
  "summary": "checkout-service 当前健康",
  "evidence": [
    "5分钟错误率 0.3%",
    "最近一次部署 2小时前成功",
    "关键依赖接口正常"
  ],
  "next_steps": [
    "继续观察 15 分钟",
    "若错误率 > 1% 触发告警流程"
  ]
}
```

## 2.4 模块2 验收
1. 三个工具都可被 Agent 正确调用。
2. 输出结构稳定。

---

## 模块3：安全链路补齐

## 3.1 必须接入的安全点
1. 输入 Guardrails。
2. 输出 Guardrails。
3. 工具参数白名单校验。
4. 工具权限最小化。

## 3.2 典型风险与处理
1. 用户请求危险操作：拒绝并提供合规替代。
2. 输出含敏感信息：脱敏或阻断。
3. 工具参数越界：直接拒绝。

## 3.3 安全审计最小字段
1. request_id
2. blocked_reason
3. policy_version
4. actor/session

## 3.4 模块3 验收
1. 你能演示一次“高风险请求被拦截”。
2. 你能展示审计日志字段。

---

## 模块4：可观测与告警

## 4.1 必加指标
1. agent_request_total
2. agent_success_rate
3. tool_call_latency_p95
4. guardrail_block_rate
5. fallback_rate

## 4.2 必加日志字段
1. query_type
2. selected_tools
3. tool_errors
4. final_status
5. model_id/prompt_version

## 4.3 告警最小规则
1. 成功率跌破阈值。
2. 工具超时率升高。
3. Guardrails 错误率异常。

## 4.4 模块4 验收
1. 你能从 dashboard 看到一次完整请求轨迹。
2. 你能解释每条告警对应的风险。

---

## 模块5：故障演练与回滚

## 5.1 必做三种演练
1. 工具接口超时。
2. 模型调用限流。
3. Guardrails 配置误判率突增。

## 5.2 回滚路径
1. 代码级回滚（Git revert）。
2. 配置级回滚（Helm/Argo 版本回退）。
3. 策略级回滚（Guardrails policy version 回退）。

## 5.3 演练记录模板
1. 触发条件
2. 发现方式
3. 处置动作
4. 恢复时间
5. 后续改进

## 5.4 模块5 验收
1. 你能在 15 分钟内完成一次故障定位+恢复演练。
2. 你有完整演练记录。

---

## 模块6：答辩材料准备

## 6.1 你要准备的 6 页内容
1. 问题背景：为什么要做这个系统。
2. 架构图：组件与数据流。
3. 关键设计：安全、可观测、回滚。
4. 演示结果：成功路径+失败路径。
5. 指标结果：成功率、延迟、拦截率、成本。
6. 下一步路线：如何从 Demo 进化到生产。

## 6.2 评审最爱问的问题（提前准备答案）
1. 为什么选择 Agent，不是普通检索问答？
2. 工具调用失败时会不会胡编？
3. Guardrails 误判怎么处理？
4. 成本如何控制？
5. 这套方案怎么扩展到更多服务？

## 6.3 演示脚本（5分钟版）
1. 30秒：系统介绍。
2. 90秒：正常请求演示。
3. 90秒：风险请求被拦截演示。
4. 60秒：故障恢复演示。
5. 60秒：观测与指标总结。

## 6.4 模块6 验收
1. 你能在 5 分钟内完整演示。
2. 你能回答 5 个高频追问。

---

## 模块7：模拟答辩 + 最终交付

## 7.1 最终交付清单
1. 代码仓库（可运行）。
2. 部署文档（README）。
3. 架构图（可读）。
4. 演示脚本。
5. 运维手册（Runbook）。
6. 复盘报告（风险与改进）。

## 7.2 模拟答辩建议
找同事或朋友扮演评审，重点追问：
1. 安全边界是否闭环。
2. 故障是否可恢复。
3. 成本是否可控。

## 7.3 复盘输出模板
1. 做得好的三点。
2. 最薄弱的三点。
3. 下一阶段 30 天优化计划。

## 7.4 模块7 验收
1. 交付清单完整。
2. 能完成一次模拟答辩。

---

## 建议项目目录结构（可直接参考）
```text
final-project/
  app/
    agent.py
    tools.py
    guardrails.py
    observability.py
  deploy/
    helm/
    argocd/
  docs/
    architecture.md
    runbook.md
    demo-script.md
    postmortem.md
  tests/
```

---

## 公司沟通可直接说的话术
1. “这个 Demo 重点不是炫技，而是验证端到端可靠性与治理闭环。”
2. “我们把安全、观测、回滚都设计成了系统能力，不依赖个人经验。”
3. “Agent 只负责编排，关键决策基于工具证据，不做无依据推断。”
4. “所有关键配置版本化，可灰度、可回滚、可审计。”
5. “下一步是把单服务扩展到多服务，并把人工确认策略细化。”

---

## 第12周自测题（含答案）

## 题目
1. 最终项目为什么要先做范围控制？
2. 端到端链路中最容易失控的是哪一段？
3. 为什么演示要同时包含成功路径和失败路径？
4. Guardrails、工具权限、审计日志三者如何配合？
5. 你怎么证明系统不是“看起来能跑”？
6. 什么指标能证明系统稳定性在提升？
7. 发生误判时你如何快速恢复？
8. 答辩中如何解释“可扩展性”？
9. 你的系统如何做到成本可控？
10. 从 Demo 到生产落地还差哪三件事？

## 参考答案
1. 避免范围膨胀导致交付失败。
2. 工具调用与安全策略交界处最易出问题。
3. 评审更看重异常处理能力而不只是理想路径。
4. Guardrails 控内容，权限控操作，审计保可追踪。
5. 提供可复现实验、指标、故障演练和回滚记录。
6. 成功率、P95 延迟、故障恢复时间、误判率下降。
7. 回滚策略版本并按Runbook执行恢复。
8. 通过模块化工具、统一schema、环境分层来扩展。
9. 控模型参数、减少无效调用、做成本监控。
10. 自动化测试完善、生产级权限治理、灰度发布策略。

---

## 第12周完成标准（100%）
满足以下 8 条，你这 12 周计划就完整闭环：
1. 有可运行端到端 Demo。
2. 有安全与权限边界。
3. 有可观测和告警能力。
4. 有故障演练与回滚记录。
5. 有可复用部署与运行文档。
6. 有清晰答辩材料与演示脚本。
7. 有下一阶段优化路线图。
8. 能独立讲清“为什么这么设计”。

---

## 12周完成后的下一步（30天建议）
1. 把 Demo 接入真实值班流程的一小段（低风险场景）。
2. 补自动化测试与评测集（回归防退化）。
3. 拉一次跨组评审（infra + app + security），定生产化里程碑。


---

## 讲义补充：知识图谱
1. 核心概念：先建立定义，再建立关系，再落实到可执行动作。
2. 工程路径：先跑通最小链路，再补安全和可观测，最后再做优化。
3. 质量标准：可复现、可观测、可回滚、可审计。

## 讲义补充：高频误区
1. 只看功能演示，不做失败路径与回滚设计。
2. 只有命令清单，没有“为什么这样做”的解释。
3. 只有部署动作，没有权限边界和成本约束。
4. 只做一次跑通，没有沉淀可复用模板。

## 讲义补充：进阶实践清单
1. 把本讲义的关键配置全部放进 Git 并走 PR 审核。
2. 为每个关键动作补一条自动化检查（lint/test/policy/check）。
3. 给每次变更写最小复盘：变更点、风险、回滚点、验证结果。
4. 在团队内做一次 10 分钟分享，验证你是否真的掌握。

## 讲义补充：学习验收方式
1. 能口头讲清关键概念和关系图。
2. 能独立完成一次从配置到验证到排错的闭环。
3. 能回答“为什么这么设计、风险在哪里、如何回滚”。
4. 能把内容迁移到你们真实业务场景。
